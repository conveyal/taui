# Taui

[![NPM version][npm-image]][npm-url]
[![Build status][travis-image]][travis-url]

![Taui screenshot](screenshot.png?raw=true "Taui screenshot")

## Running

Clone the repository and with [yarn](https://yarnpkg.com/en/) and [node v8](https://nodejs.org/en/) installed run `yarn start`. Changes to JavaScript and CSS will be rebuilt automatically. Refresh your web page to see changes. Changes to configuration files require a full stop and fresh `yarn start`.

## Configuration

Taui allows changing it's source data live by default. It's set via JSON and an example can be found in `config.json.tmp`. Opportunities can be set in the `grids` field and transit networks generated by an r5 regional analysis can be set in networks.

For permanent deployments, set `DISABLE_CONFIG: true` in the `env.yml` file and set the configuration data in `store.yml` under the `data` field.

## Deploy

Once you see that TAUI is working properly with your static site data, deploy it to the S3 bucket specified in settings.yml with the following command (replacing the --config switch to point to your configuration directory):

`mastarm deploy --config configurations/marseilles --minify --env production`

The AWS SDK for JS will detect and use the same AWS credentials you should have set up for AWSCLI. The deployment copies JS and CSS files into a sub-bucket called assets, but does not upload `index.html`. You need to edit `index.html` in the root of the TAUI repository to customize the page name, then upload it with `aws s3 cp index.html s3://your-bucket-name/index.html`.

`mastarm deploy` will not create the bucket or set its contents public. You need to ensure the bucket exists before running `mastarm deploy` and set all its contents public afterward using the S3 web console or CLI. You don’t need to set any permissions on the bucket itself.

If S3 reports “access denied” when you try to fetch a page over HTTP in your browser, this is often because an object you are requesting does not exist.

[npm-image]: https://img.shields.io/npm/v/@conveyal/taui.svg?maxAge=2592000&style=flat-square
[npm-url]: https://www.npmjs.com/package/@conveyal/taui
[travis-image]: https://img.shields.io/travis/conveyal/taui.svg?style=flat-square
[travis-url]: https://travis-ci.org/conveyal/taui
