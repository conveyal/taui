#!/usr/bin/env node

const babelify = require('babelify')
const budo = require('budo')
const envify = require('envify/custom')
const path = require('path')

const args = process.argv.slice(2)
const dir = path.resolve(process.cwd(), args[0] || 'configurations/default')

const defaultEnvify = {
  _: 'purge',
  NODE_ENV: process.env.NODE_ENV || 'development'
}

budo.cli(['src/index.js:dist/bundle.js'], {
  browserify: {
    debug: true,
    transform: [
      ['browserify-css', {global: true}],
      babelify.configure({
        env: {
          development: {
            plugins: [['react-transform', {
              transforms: [{
                transform: 'react-transform-catch-errors',
                imports: ['react', 'redbox-react']
              }, {
                transform: 'react-transform-render-visualizer'
              }]
            }]]
          }
        },
        plugins: ['transform-runtime'],
        presets: ['es2015', 'react', 'stage-0']
      }),
      envify(Object.assign(defaultEnvify, require(`${dir}/env.json`)))
    ]
  }
})
